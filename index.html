<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ¹–å—çœè€ƒè®¡æ—¶ç¬”è®°</title>
    <style>
        :root {
            --primary: #D32F2F; --primary-dark: #b71c1c; --secondary: #1976D2;
            --bg: #f5f7fa; --card: #ffffff; --text: #333333; --success: #4CAF50; --process: #0288D1; --warning: #FF9800;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 150px; -webkit-tap-highlight-color: transparent; }
        
        /* å¤´éƒ¨ */
        .header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 15px 20px 25px 20px; border-radius: 0 0 25px 25px; position: relative; box-shadow: 0 4px 15px rgba(211,47,47,0.2); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .app-title { font-weight: 800; font-size: 1.1rem; }
        .icon-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; border: none; }
        .date-nav { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.15); border-radius: 12px; padding: 10px; margin-bottom: 12px; }
        .nav-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; line-height: 1; }
        .progress-bar-bg { height: 6px; background: rgba(0,0,0,0.2); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: #FFD700; width: 0%; transition: width 0.4s; }
        .back-today { position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); background: #FFD700; color: #b71c1c; padding: 5px 15px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; cursor: pointer; display: none; z-index: 10; border: 1px solid #b71c1c; }

        /* åˆ—è¡¨é¡¹ */
        .task-list { padding: 0 15px; }
        .task-item { background: white; margin: 15px 0; padding: 16px; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); border-left: 6px solid #ddd; position: relative; }
        .task-item.in-progress { border-left-color: var(--process); background: #f0f9ff; }
        .task-item.completed { border-left-color: var(--success); background: #f9fff9; }
        
        .del-day-btn { position: absolute; top: 12px; right: 12px; color: #ff5252; font-size: 0.9rem; cursor: pointer; border: 1px solid #ffebee; background: #fff; padding: 2px 6px; border-radius: 6px; }
        .status-btn { width: 62px; height: 62px; border: 2px solid #ddd; border-radius: 14px; margin-right: 12px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75rem; font-weight: bold; background: white; color: #999; text-align: center; }
        .task-item.completed .status-btn { background: var(--success); border-color: var(--success); color: white; }
        .task-item.in-progress .status-btn { border-color: var(--process); color: var(--process); }

        .task-input-title { width: 80%; border: none; background: transparent; font-size: 1rem; font-weight: 600; padding: 2px 0; border-bottom: 1px dashed #eee; outline: none; }
        .time-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; font-weight: bold; background: #eee; color: #666; margin-right: 5px; }
        .duration-badge { font-size: 0.7rem; color: white; background: var(--warning); padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .task-note-area { width: 100%; border: none; background: #f8f8f8; border-radius: 8px; padding: 10px; font-size: 0.85rem; margin-top: 10px; resize: none; outline: none; box-sizing: border-box; }

        /* æ»‘åŠ¨æ—¶é—´é€‰æ‹©å™¨ä¸è¡¨å• */
        .bottom-modal { position: fixed; bottom: 0; left: 0; right: 0; background: white; z-index: 2000; border-radius: 25px 25px 0 0; padding: 20px; transform: translateY(100%); transition: transform 0.3s; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .bottom-modal.active { transform: translateY(0); }
        .form-row { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: bold; }
        .form-input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; box-sizing: border-box; outline: none; }
        .form-input:focus { border-color: var(--secondary); }
        
        .modal-mask { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1999; display: none; }

        /* æŒ‰é’®ç»„ */
        .btn-main { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; }
        .daily-action-bar { padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .btn-ghost { width: 100%; padding: 12px; background: #fff; color: var(--secondary); border: 1px dashed var(--secondary); border-radius: 12px; font-weight: bold; cursor: pointer; }

        /* æ¨¡æ€æ¡†åŸºç¡€ */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; display: none; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-card { background: white; width: 94%; max-width: 500px; height: 85vh; border-radius: 24px; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 18px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .modal-body { flex: 1; overflow-y: auto; padding: 15px; }
        .edit-phase-section { border: 1px solid #eee; border-radius: 12px; padding: 12px; margin-bottom: 20px; background: #fafafa; }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-top">
            <div class="app-title">2026 æ¹–å—çœè€ƒè®¡æ—¶ç¬”è®°</div>
            <div class="btn-group">
                <button class="icon-btn" onclick="openPlanModal()">è§„åˆ’</button>
                <button class="icon-btn" onclick="openHistoryModal()">æ—¥å†</button>
                <button class="icon-btn" onclick="showSettings()">å¤‡ä»½</button>
            </div>
        </div>
        <div class="date-nav">
            <button class="nav-btn" onclick="changeDay(-1)">â€¹</button>
            <div style="text-align:center">
                <div class="date-main" id="headerDate">--æœˆ--æ—¥</div>
                <div class="date-sub" id="headerSub">--</div>
            </div>
            <button class="nav-btn" onclick="changeDay(1)">â€º</button>
        </div>
        <div class="progress-bar-bg"><div class="progress-fill" id="progressBar"></div></div>
        <div class="back-today" id="backTodayBtn" onclick="goToToday()">å›åˆ°ä»Šå¤©</div>
    </div>

    <div id="phaseContainer"></div>
    <div class="task-list" id="taskList"></div>
    
    <div class="daily-action-bar">
        <button class="btn-ghost" onclick="openAddTaskModal()">+ ä¸ºä»Šæ—¥å¢åŠ ç‰¹æ®Šä»»åŠ¡ (è¡¨å•æ¨¡å¼)</button>
        <button onclick="clearDailyTasks()" style="color:#999; border:none; background:none; font-size:0.8rem; margin-top:5px;">ğŸ—‘ï¸ ä¸€é”®æ¸…ç©ºä»Šæ—¥åˆ—è¡¨</button>
    </div>

    <div class="modal-mask" id="globalMask" onclick="closeAllBottomModals()"></div>
    <div class="bottom-modal" id="timePickerModal">
        <div id="timeModalTitle" style="font-weight:bold; text-align:center; color:var(--secondary); margin-bottom:10px;">æ‰“å¡æ—¶é—´ç¡®è®¤</div>
        <input type="time" id="nativeTimeInput" class="form-input" style="height:60px; font-size:1.8rem; text-align:center;">
        <button class="btn-main" onclick="confirmTimeSelection()" style="margin-top:15px;">ç¡®è®¤æ‰“å¡</button>
    </div>

    <div class="bottom-modal" id="addTaskFormModal">
        <div style="font-weight:bold; text-align:center; color:var(--secondary); margin-bottom:15px;">æ–°å¢ä»Šæ—¥ç‰¹æ®Šä»»åŠ¡</div>
        <div class="form-row">
            <label class="form-label">ä»»åŠ¡åç§°</label>
            <input type="text" id="new_title" class="form-input" placeholder="ä¾‹å¦‚ï¼šåŠ ç»ƒä¸€å¥—è¡Œæµ‹å·">
        </div>
        <div class="form-row">
            <label class="form-label">å‚è€ƒå¼€å§‹æ—¶é—´</label>
            <input type="time" id="new_time" class="form-input" value="09:00">
        </div>
        <div class="form-row" style="display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="new_isDur" style="width:20px; height:20px;">
            <label for="new_isDur" style="font-size:0.9rem; font-weight:bold;">å¼€å¯è®°æ—¶é•¿æ¨¡å¼ (è®°å½•å¼€å§‹+ç»“æŸ)</label>
        </div>
        <button class="btn-main" onclick="submitNewTaskDaily()">åŠ å…¥ä»Šæ—¥æ¸…å•</button>
        <button onclick="closeAllBottomModals()" style="width:100%; border:none; background:none; color:#999; margin-top:10px;">å–æ¶ˆ</button>
    </div>

    <div class="modal-overlay" id="planModal"><div class="modal-card">
        <div class="modal-header"><span>é˜¶æ®µä»»åŠ¡æ¨¡æ¿(å…¨å±€)</span><button onclick="closeModal('planModal')" style="border:none;background:none;font-size:1.5rem">âœ•</button></div>
        <div class="modal-body" id="planEditorBody"></div>
        <button onclick="saveAllPlans()" class="btn-main" style="border-radius:0;">ğŸ’¾ ä¿å­˜æ¨¡æ¿</button>
    </div></div>

    <div class="modal-overlay" id="historyModal"><div class="modal-card">
        <div class="modal-header"><span>å…¨æ—¶æ®µæ—¥å†</span><button onclick="closeModal('historyModal')" style="border:none;background:none;font-size:1.5rem">âœ•</button></div>
        <div class="modal-body" id="historyContent"></div>
    </div></div>

    <div class="modal-overlay" id="settingsModal"><div class="modal-card" style="height: auto; padding: 20px;">
        <button onclick="exportData()" class="btn-main" style="background:var(--secondary); margin-bottom:10px;">ğŸ“¤ å¯¼å‡ºå…¨é‡å¤‡ä»½</button>
        <button onclick="document.getElementById('importFile').click()" class="btn-main" style="background:#eee; color:#333;">ğŸ“¥ å¯¼å…¥æ¢å¤</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(this)">
        <button onclick="resetAllData()" style="color:red; margin-top:20px; border:none; background:none; width:100%;">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰ç³»ç»Ÿæ•°æ®</button>
    </div></div>

    <script>
        const EXAM_DATE = new Date('2026-03-14');
        const START_DATE = new Date('2026-01-01');
        let currentViewDate = new Date();
        let activeTaskContext = { idx: -1, planned: '', isDur: false };

        // --- Phase 0-4 é¢„è®¾æ•°æ® (å®Œæ•´æ¤å…¥) ---
        const DEFAULT_PLAN_CONFIG = [
            { id: 0, title: "Phase 0ï¼šç‰©èµ„ä¸èº«å¿ƒæ•´å¤‡", desc: "1.1-1.6 æ¸…ç†ä¹¦æ¡Œï¼Œå‡†å¤‡0.5mmé»‘ç¬”ã€è¡¥å‰‚ã€‚", range: [1,1,1,6], tasks: [{t:"08:30", title:"ğŸ“… è®¡åˆ’é€šè§ˆ", isDuration:false},{t:"10:00", title:"ğŸ–Šï¸ ç‰©èµ„é‡‡è´­", isDuration:false},{t:"14:00", title:"ğŸ§¹ ç¯å¢ƒæ¸…ç†", isDuration:false},{t:"20:00", title:"ğŸ“± æˆ’æ–­è®¾ç½®", isDuration:false},{t:"22:30", title:"ğŸ’¤ å¼ºåˆ¶æ—©ç¡", isDuration:false}]},
            { id: 1, title: "Phase 1ï¼šåŸºçŸ³ä¿®å¤æœŸ", desc: "1.7-1.27 ä¸»æ”»èµ„æ–™åˆ†æã€æ•°é‡å…³ç³»ã€å¸¸è¯†æ¡†æ¶ã€‚", range: [1,7,1,27], tasks: [{t:"07:30", title:"èµ·å±…å¯åŠ¨", isDuration:false},{t:"08:00", title:"æ™¨è¯»æ¹˜æƒ…", isDuration:false},{t:"08:30", title:"èµ„æ–™åˆ†æ (é»˜å†™å…¬å¼)", isDuration:true},{t:"10:45", title:"æ•°é‡å…³ç³» (è¡Œç¨‹çœŸé¢˜)", isDuration:true},{t:"14:00", title:"è¨€è¯­åˆ¤æ–­", isDuration:true},{t:"16:00", title:"æ·±åº¦å¤ç›˜", isDuration:true},{t:"20:00", title:"å›¾å½¢æ”¿æ²»", isDuration:false}]},
            { id: 2, title: "Phase 2ï¼šæ˜¥èŠ‚ä¿æ‰‹æ„Ÿ", desc: "1.28-2.3 å¼¹æ€§å­¦ä¹ ï¼Œæ¯å¤©ä¿æŒèµ„æ–™å’Œå›¾æ¨æ‰‹æ„Ÿã€‚", range: [1,28,2,3], tasks: [{t:"09:00", title:"é˜²æ‰‹ç”Ÿè®­ç»ƒ (èµ„æ–™+å›¾æ¨)", isDuration:true},{t:"14:00", title:"æ¹–å—å¸¸è¯†", isDuration:false},{t:"16:00", title:"å±…å®¶è¿åŠ¨", isDuration:false}]},
            { id: 3, title: "Phase 3ï¼šæé€Ÿæ”»åšæœŸ", desc: "2.4-3.7 æ–‡ç†äº¤å‰å¼ºæ”»ï¼Œç”³è®ºæ‰‹å†™å®æˆ˜ã€‚", range: [2,4,3,7], tasks: [{t:"08:30", title:"ğŸ”´ å¼ºæ”»ä¸“é¡¹", isDuration:true},{t:"10:45", title:"ğŸ”µ è¾…ç»ƒä¸“é¡¹", isDuration:true},{t:"14:00", title:"ç”³è®ºæ‰‹å†™", isDuration:true},{t:"20:00", title:"ä»Šæ—¥é”™é¢˜å¤ç›˜", isDuration:true}]},
            { id: 4, title: "Phase 4ï¼šè€ƒå‰å…¨çœŸæ¨¡è€ƒ", desc: "3.8-3.13 é€‚åº”è€ƒåœºèŠ‚å¥ï¼Œå¿…é¡»æ¶‚å¡å¤ç›˜ã€‚", range: [3,8,3,13], tasks: [{t:"07:00", title:"æ—©èµ·æ¨¡æ‹Ÿ", isDuration:false},{t:"09:00", title:"âš¡ å…¨çœŸæ¨¡è€ƒ (120åˆ†é’Ÿ)", isDuration:true},{t:"14:00", title:"ç”³è®ºå¤ç›˜", isDuration:true},{t:"19:00", title:"æŠ¼é¢˜èƒŒè¯µ", isDuration:false}]}
        ];

        const getPlans = () => JSON.parse(localStorage.getItem('hunan_plan_config') || JSON.stringify(DEFAULT_PLAN_CONFIG));
        const formatDate = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        const timeToMins = s => { if(!s || !s.includes(':')) return 0; const [h,m]=s.split(':').map(Number); return h*60+m; };

        function getDailyTaskList(date) {
            const dk = formatDate(date);
            const dailyCustom = localStorage.getItem('hunan_daily_tasks_' + dk);
            if (dailyCustom) return JSON.parse(dailyCustom);
            const m = date.getMonth()+1; const d = date.getDate(); const plans = getPlans();
            let f = plans.find(p => { const [sm,sd,em,ed]=p.range; return (m*100+d) >= (sm*100+sd) && (m*100+d) <= (em*100+ed); });
            return f ? JSON.parse(JSON.stringify(f.tasks)) : [];
        }

        function render() {
            const dk = formatDate(currentViewDate); 
            const tasks = getDailyTaskList(currentViewDate);
            const m = currentViewDate.getMonth()+1; const d = currentViewDate.getDate(); 
            const plans = getPlans();
            let phaseInfo = plans.find(p => { const [sm,sd,em,ed]=p.range; return (m*100+d) >= (sm*100+sd) && (m*100+d) <= (em*100+ed); }) || {title:"å¤‡è€ƒæœŸ", desc:"è‡ªç”±å®‰æ’"};

            document.getElementById('headerDate').innerText = `${m}æœˆ${d}æ—¥`;
            const diff = Math.ceil((EXAM_DATE - currentViewDate)/86400000);
            document.getElementById('headerSub').innerText = diff >= 0 ? `è·çœè€ƒ ${diff} å¤©` : "å·²è€ƒå®Œ";
            document.getElementById('backTodayBtn').style.display = (dk === formatDate(new Date())) ? 'none' : 'block';
            document.getElementById('phaseContainer').innerHTML = `<div class="phase-card"><div style="font-weight:bold; color:var(--secondary)">${phaseInfo.title}</div><div style="font-size:0.8rem; color:#666">${phaseInfo.desc}</div></div>`;

            const s = JSON.parse(localStorage.getItem('hunan_start_times_'+dk)||'{}');
            const e = JSON.parse(localStorage.getItem('hunan_actual_times_'+dk)||'{}');
            const done = JSON.parse(localStorage.getItem('hunan_exam_'+dk)||'[]');
            const notes = JSON.parse(localStorage.getItem('hunan_notes_'+dk)||'{}');

            const listEl = document.getElementById('taskList'); listEl.innerHTML = '';
            tasks.forEach((t, i) => {
                const isD = done.includes(i); const isDur = t.isDuration; const isP = isDur && s[i] && !e[i];
                let btnLbl = isDur ? (isD ? "å®Œæˆ" : (isP ? "è®°ç»“æŸ" : "è®°å¼€å§‹")) : (isD ? "å·²è®°" : "æ ‡è®°");
                let durTxt = (isDur && s[i] && e[i]) ? `${timeToMins(e[i]) - timeToMins(s[i])}min` : "";

                listEl.innerHTML += `
                    <div class="task-item ${isD?'completed':(isP?'in-progress':'')}">
                        <button class="del-day-btn" onclick="removeTaskDaily(${i})">âœ•</button>
                        <div style="display:flex">
                            <div class="status-btn" onclick="triggerTimePicker(${i},'${t.t}',${isDur})">${btnLbl}</div>
                            <div style="flex:1">
                                <span style="font-size:0.7rem;color:#999">å‚è€ƒ: ${t.t}</span>
                                <input type="text" class="task-input-title" value="${t.title}" onchange="editTaskDaily(${i}, this.value)">
                                <div style="display:flex; flex-wrap:wrap; gap:5px; margin-top:5px;">
                                    ${s[i]?`<span class="time-badge">å§‹ ${s[i]}</span>`:''}
                                    ${e[i]?`<span class="time-badge">ç»ˆ ${e[i]}</span>`:''}
                                    ${durTxt?`<span class="duration-badge">${durTxt}</span>`:''}
                                </div>
                            </div>
                        </div>
                        <textarea class="task-note-area" rows="1" placeholder="ä»Šæ—¥æ„Ÿæ‚Ÿ/é”™é¢˜..." onchange="saveNoteDaily(${i}, this.value)">${notes[i]||''}</textarea>
                    </div>`;
            });
            document.getElementById('progressBar').style.width = (tasks.length ? (done.length/tasks.length*100) : 0) + '%';
        }

        // --- æ ¸å¿ƒï¼šæ»‘åŠ¨æ—¶é—´æ‰“å¡é€»è¾‘ ---
        function triggerTimePicker(idx, planned, isDur) {
            const dk = formatDate(currentViewDate);
            let s = JSON.parse(localStorage.getItem('hunan_start_times_'+dk)||'{}');
            let e = JSON.parse(localStorage.getItem('hunan_actual_times_'+dk)||'{}');
            activeTaskContext = { idx, planned, isDur };
            
            if (!isDur && s[idx]) { if(confirm("é‡ç½®æ ‡è®°ï¼Ÿ")){ delete s[idx]; clearEntry(idx,dk); } return; }
            if (isDur && s[idx] && e[idx]) { if(confirm("é‡ç½®è®¡æ—¶ï¼Ÿ")){ delete s[idx]; delete e[idx]; clearEntry(idx,dk); } return; }

            const now = new Date();
            const realTime = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            document.getElementById('nativeTimeInput').value = realTime;
            document.getElementById('timeModalTitle').innerText = isDur ? (s[idx]?"ç»“æŸæ‰“å¡":"å¼€å§‹æ‰“å¡") : "æ ‡è®°æ‰“å¡";
            
            document.getElementById('timePickerModal').classList.add('active');
            document.getElementById('globalMask').style.display = 'block';
        }

        function confirmTimeSelection() {
            const dk = formatDate(currentViewDate);
            const val = document.getElementById('nativeTimeInput').value;
            const { idx, isDur } = activeTaskContext;
            let s = JSON.parse(localStorage.getItem('hunan_start_times_'+dk)||'{}');
            let e = JSON.parse(localStorage.getItem('hunan_actual_times_'+dk)||'{}');
            let d = JSON.parse(localStorage.getItem('hunan_exam_'+dk)||'[]');

            if (!isDur) { s[idx] = val; if(!d.includes(idx)) d.push(idx); }
            else { if(!s[idx]) s[idx] = val; else { e[idx] = val; if(!d.includes(idx)) d.push(idx); } }

            localStorage.setItem('hunan_start_times_'+dk, JSON.stringify(s));
            localStorage.setItem('hunan_actual_times_'+dk, JSON.stringify(e));
            localStorage.setItem('hunan_exam_'+dk, JSON.stringify(d));
            closeAllBottomModals(); render();
        }

        // --- æ ¸å¿ƒï¼šè¡¨å•å¼å¢åŠ ä»»åŠ¡ ---
        function openAddTaskModal() {
            const now = new Date();
            document.getElementById('new_time').value = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            document.getElementById('addTaskFormModal').classList.add('active');
            document.getElementById('globalMask').style.display = 'block';
        }

        function submitNewTaskDaily() {
            const title = document.getElementById('new_title').value || "ç‰¹æ®Šä»»åŠ¡";
            const time = document.getElementById('new_time').value;
            const isDur = document.getElementById('new_isDur').checked;
            
            const dk = formatDate(currentViewDate);
            const tasks = getDailyTaskList(currentViewDate);
            tasks.push({t: time, title: title, isDuration: isDur});
            
            localStorage.setItem('hunan_daily_tasks_' + dk, JSON.stringify(tasks));
            document.getElementById('new_title').value = "";
            closeAllBottomModals(); render();
        }

        function clearDailyTasks() { if(confirm("æ¸…ç©ºä»Šæ—¥åˆ—è¡¨ï¼Ÿ")){ const dk = formatDate(currentViewDate); localStorage.setItem('hunan_daily_tasks_' + dk, JSON.stringify([])); render(); } }
        function closeAllBottomModals() { document.querySelectorAll('.bottom-modal').forEach(m => m.classList.remove('active')); document.getElementById('globalMask').style.display = 'none'; }
        function clearEntry(i,dk) { let d=JSON.parse(localStorage.getItem('hunan_exam_'+dk)||'[]'); d=d.filter(x=>x!==i); localStorage.setItem('hunan_exam_'+dk,JSON.stringify(d)); render(); }

        // --- é€šç”¨è¾…åŠ©é€»è¾‘ ---
        function removeTaskDaily(idx) { const dk = formatDate(currentViewDate); const tasks = getDailyTaskList(currentViewDate); tasks.splice(idx, 1); localStorage.setItem('hunan_daily_tasks_' + dk, JSON.stringify(tasks)); render(); }
        function editTaskDaily(idx, val) { const dk = formatDate(currentViewDate); const tasks = getDailyTaskList(currentViewDate); tasks[idx].title = val; localStorage.setItem('hunan_daily_tasks_' + dk, JSON.stringify(tasks)); }
        function saveNoteDaily(idx, val) { const dk = formatDate(currentViewDate); let n = JSON.parse(localStorage.getItem('hunan_notes_'+dk)||'{}'); n[idx] = val; localStorage.setItem('hunan_notes_'+dk, JSON.stringify(n)); }
        function changeDay(o) { currentViewDate.setDate(currentViewDate.getDate()+o); render(); }
        function goToToday() { currentViewDate = new Date(); render(); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function openPlanModal() { editingPlans = getPlans(); renderPlanEditor(); document.getElementById('planModal').classList.add('active'); }
        function renderPlanEditor() { document.getElementById('planEditorBody').innerHTML = editingPlans.map((p, pIdx) => `<div class="edit-phase-section"><b>${p.title}</b><br>${p.tasks.map((t, tIdx) => `<div style="display:flex;gap:5px;margin:5px 0;"><input type="text" value="${t.t}" style="width:40px" onchange="editingPlans[${pIdx}].tasks[${tIdx}].t=this.value"><input type="text" value="${t.title}" style="flex:1" onchange="editingPlans[${pIdx}].tasks[${tIdx}].title=this.value"><input type="checkbox" ${t.isDuration?'checked':''} onchange="editingPlans[${pIdx}].tasks[${tIdx}].isDuration=this.checked"></div>`).join('')}</div>`).join(''); }
        function saveAllPlans() { localStorage.setItem('hunan_plan_config', JSON.stringify(editingPlans)); closeModal('planModal'); render(); }
        function openHistoryModal() {
            const b = document.getElementById('historyContent'); b.innerHTML = '';
            let itr = new Date(START_DATE); while(itr <= EXAM_DATE) {
                const dk = formatDate(itr); const done = JSON.parse(localStorage.getItem('hunan_exam_'+dk)||'[]').length;
                b.innerHTML += `<div style="padding:12px; border-bottom:1px solid #eee;" onclick="viewDate('${dk}')">${itr.getMonth()+1}æœˆ${itr.getDate()}æ—¥ - ${done}é¡¹æˆ</div>`;
                itr.setDate(itr.getDate()+1);
            }
            document.getElementById('historyModal').classList.add('active');
        }
        function viewDate(k) { currentViewDate = new Date(k); render(); closeModal('historyModal'); }
        function showSettings() { document.getElementById('settingsModal').classList.add('active'); }
        function exportData() { let d={}; for(let i=0;i<localStorage.length;i++){ let k=localStorage.key(i); if(k.startsWith('hunan_')) d[k]=localStorage.getItem(k); } const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(d)],{type:'application/json'})); a.download=`å¤‡ä»½_${formatDate(new Date())}.json`; a.click(); }
        function importData(i) { const r=new FileReader(); r.onload=e=>{ try{ const d=JSON.parse(e.target.result); for(let k in d)localStorage.setItem(k,d[k]); location.reload(); }catch(e){alert("å¯¼å…¥å¤±è´¥")} }; r.readAsText(i.files[0]); }
        function resetAllData() { if(confirm("ç¡®å®šæ¸…ç©ºæ•°æ®ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
        function showToast(m) { const t=document.getElementById('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1000); }
        function switchCalendar(t) { calType=t; renderCalendarBody(); } // ç®€åŒ–ç‰ˆæ ‡ç­¾åˆ‡æ¢é€»è¾‘
        
        render();
    </script>
</body>
</html>
